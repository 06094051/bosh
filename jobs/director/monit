check process director
  with pidfile /var/vcap/sys/run/bpm/director/director.pid
  start program "/var/vcap/pacakges/bpm/bin/bpm start director -p director"
  stop program "/var/vcap/pacakges/bpm/bin/bpm stop director"
  group vcap

<% (1..(p('director.workers', 3))).each do |index| %>
check process worker_<%= index %>
  with pidfile /var/vcap/sys/run/bpm/director/worker_<%= index %>.pid
  start program "/var/vcap/pacakges/bpm/bin/bpm start director -p worker_<%= index %> -c /var/vcap/jobs/director/config/bpm/worker.yml"
  stop program "/var/vcap/pacakges/bpm/bin/bpm stop director -p worker_<%= index %>"
  group vcap
  depends on director
<% end%>

check process director_scheduler
  with pidfile /var/vcap/sys/run/bpm/director/scheduler.pid
  start program "/var/vcap/pacakges/bpm/bin/bpm start director -p scheduler"
  stop program "/var/vcap/pacakges/bpm/bin/bpm stop director -p scheduler"
  group vcap

<% if_p('director.local_dns.enabled') do |enabled| %>
  <% if enabled %>
check process director_sync_dns
  with pidfile /var/vcap/sys/run/bpm/director/sync_dns.pid
  start program "/var/vcap/pacakges/bpm/bin/bpm start director -p sync_dns"
  stop program "/var/vcap/pacakges/bpm/bin/bpm stop director -p sync_dns"
  group vcap
<%end%><%end%>

check process director_nginx
  with pidfile /var/vcap/sys/run/bpm/director/nginx.pid
  start program "/var/vcap/pacakges/bpm/bin/bpm start director -p nginx"
  stop program "/var/vcap/pacakges/bpm/bin/bpm stop director -p nginx"
  group vcap
